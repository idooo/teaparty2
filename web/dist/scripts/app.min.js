"use strict";!function(){function a(a,b,c,d,e){d.resizable.handles=["se"],e.setPath("/swf/ZeroClipboard.swf"),c.html5Mode(!0),b.otherwise("/d/"),a.state("app",{url:"/d/:dashboard",views:{content:{templateUrl:"/core/views/dashboard.html",controller:"CentralController as central"}}}).state("rotation",{url:"/rotation/:url",views:{content:{templateUrl:"/rotation/views/rotation.html",controller:"RotationController as rotation"}}}).state("control",{url:"/control",views:{content:{templateUrl:"/control/views/control.html",controller:"ControlController as control"}}})}function b(a,b,c,d){c.updateAuthHeader(),b.get().then(function(b){is.not.undefined(b)&&b.auth===!1?(a.isAuthorised=!0,c.token=0):c.check(void 0,function(b){a.isAuthorised=b})}),a.not=function(a){return function(b){return!a(b)}},d.init()}var c=["ngResource","ui.router","ngDialog","gridster","LocalStorageModule","btford.socket-io","ngClipboard","ui.slider","ngTouch"],d=["teaparty2.core","teaparty2.template","teaparty2.control","teaparty2.dashboard","teaparty2.rotation","teaparty2.widget","teaparty2.datasource","teaparty2.widgets","teaparty2.widgets.template"];d.forEach(function(a){return angular.module(a,[])}),angular.module("teaparty2",c.concat(d)).config(a).run(b),a.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","gridsterConfig","ngClipProvider"],b.$inject=["$rootScope","Settings","Auth","Sockets"]}(),function(){function a(a,b,c,d){function e(){c.list().$promise.then(function(a){f.rotations=a.map(function(a){return a.label=a.name||a.url,a}),is.not.empty(f.rotations)&&(f.selectedRotation=f.rotations[0])})}var f=this;f.rotations=[],f.dashboards=[],f.selectedRotation=void 0,f.pauseRotation=d.pauseRotation,f.resumeRotation=d.resumeRotation,f.changeDashboard=d.changeDashboard,f.showLoginDialog=b.login,a.$on("ngDialog.closed",function(){a.isAuthorised&&e()}),e()}angular.module("teaparty2.control").controller("ControlController",a),a.$inject=["$rootScope","ModalService","Rotation","RotationControlService"]}(),function(){function a(a,b){function c(a){return f(""+g+"/"+a+"/pause")}function d(a){return f(""+g+"/"+a+"/resume")}function e(a,b){return f(""+g+"/"+a+"/"+b)}function f(c){return b(function(b,d){var e=a.post(c);e.success(function(a){return b(a)}),e.error(function(a,b){return d(a,b)})})}var g="/api/control/rotation",h=this;h.pauseRotation=c,h.resumeRotation=d,h.changeDashboard=e}angular.module("teaparty2.control").service("RotationControlService",a),a.$inject=["$http","$q"]}(),function(){function a(a,b){function c(){return b.get(k)}function d(b){is.undefined(b)&&(b=is.undefined(l.token)?l.readTokenFromStorage():l.token),a.defaults.headers.common[j]=b}function e(a,c){l.token=a,l.isAuthorised=!0,b.set(k,a),l.updateAuthHeader(),is["function"](c)&&c(l.isAuthorised)}function f(a,c){l.token=void 0,l.isAuthorised=!1,b.remove(k),l.updateAuthHeader(),is["function"](a)&&a(l.isAuthorised,c)}function g(b,c,d){var e=a.post(i,{username:b,password:c});e.success(function(a){l.authorize(a.token,d)}),e.error(function(a){l.deauthorize(d,a)})}function h(b,c){var d;is.undefined(b)&&(b=l.readTokenFromStorage(),is["null"](b)&&(l.token=void 0)),d=a.get(""+i+"/"+b),d.success(function(){l.authorize(b,c)}),d.error(function(){l.deauthorize(c)})}var i="/api/auth",j="Authorization-Token",k="token",l=this;l.token=void 0,l.isAuthorised=!1,l.readTokenFromStorage=c,l.updateAuthHeader=d,l.authorize=e,l.deauthorize=f,l.auth=g,l.check=h}angular.module("teaparty2.core").service("Auth",a),a.$inject=["$http","localStorageService"]}(),function(){function a(a,b,c,d,e,f,g,h){function i(){var b=void 0===arguments[0]?!1:arguments[0];b&&(a.dashboards=[]);var e=function(a){if(is.not.undefined(d.dashboard)&&d.dashboard){var b=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(b=(g=h.next()).done);b=!0){var i=g.value;if(i.url===d.dashboard)return l(i)}}catch(j){e=!0,f=j}finally{try{!b&&h["return"]&&h["return"]()}finally{if(e)throw f}}c.go("app",{dashboard:""})}return l()};is.undefined(a.dashboards)||is.empty(a.dashboards)?k(function(b){a.dashboards=b,e(b)}):(q.dashboards=a.dashboards,e(q.dashboards))}function j(a){c.go("app",{dashboard:a},{reload:!1})}function k(a){f.list(function(b){q.dashboards=b,is["function"](a)&&a(q.dashboards)})}function l(a){var b;if(is.undefined(a)){if(is.empty(q.dashboards))return;b=q.dashboards[0]}else if(is.string(a)){var c=!0,d=!1,e=void 0;try{for(var g,h=q.dashboards[Symbol.iterator]();!(c=(g=h.next()).done);c=!0){var i=g.value;if(i._id===a){b=i,h["return"]&&h["return"]();break}}}catch(j){d=!0,e=j}finally{try{!c&&h["return"]&&h["return"]()}finally{if(d)throw e}}}else b=a;f.get({dashboardId:b._id},function(a){q.selectedDashboard=a,q.isDashboardLocked=!0})}function m(){q.isDashboardLocked=!q.isDashboardLocked,q.dashboardOptions.resizable.enabled=!q.dashboardOptions.resizable.enabled,q.dashboardOptions.draggable.enabled=!q.dashboardOptions.draggable.enabled}function n(){return q.settings.isDatabaseConnected?is.empty(q.dashboards)?(q.importantMessage=p[1],!1):(q.importantMessage="",!0):(q.importantMessage=p[0],!1)}function o(){h.deauthorize(),a.dashboards=void 0,a.isAuthorised=!1,c.go("app",{dashboard:""})}var p=["Database connection problem. Check application logs for details","You have no dashboards"],q=this;q.dashboards=[],q.importantMessage="",q.dashboardOptions={resizable:{enabled:!1},draggable:{enabled:!1}},q.selectedDashboard=void 0,q.goToDashboard=j,q.lockUnlockDashboard=m,q.isAnyDashboardAvailable=n,q.logout=o,q.showNewDashboardDialog=e.newDashboard,q.showRotationsDialog=e.rotations,q.showLoginDialog=e.login,q.showDashboardSettingsDialog=function(){return e.dashboardSettings({dashboard:q.selectedDashboard})},q.showNewWidgetDialog=function(){return e.newWidget({dashboard:q.selectedDashboard})},q.isHeaderOpen=!1,q.isDashboardLocked=!0,g.get().then(function(a){return q.settings=a}),i(),b.$on("dashboardAddedEvent",function(a,b){d.dashboard=b.url,i(!0)}),b.$on("dashboardDeletedEvent",function(){return i(!0)}),b.$on("dashboardUpdatedEvent",function(b,c){c.reload?i():k(function(b){return a.dashboards=b})}),b.$on("widgetAddedEvent",function(a,b){return l(b.dashboardId)}),b.$on("widgetDeletedEvent",function(a,b){return l(b.dashboardId)}),b.$on("userAuthEvent",function(){k(function(b){a.dashboards=b})})}angular.module("teaparty2.core").controller("CentralController",a),a.$inject=["$rootScope","$scope","$state","$stateParams","ModalService","Dashboard","Settings","Auth"]}(),function(){function a(a,b,c){var d=this;d.error="",d.login=function(){c.auth(d.username,d.password,function(c,e){a.isAuthorised=c,a.$broadcast("userAuthEvent"),c?b.close():d.error=e})}}angular.module("teaparty2.core").controller("LoginController",a),a.$inject=["$rootScope","ngDialog","Auth"]}(),function(){function a(a){function b(){for(var a in e)d[a]=c(e[a].template,e[a].controller,e[a].className)}function c(b,c,d){var e={template:""+b,controller:""+c+" as ctrl"};return is.not.undefined(d)&&(e.className=d),function(b){is.not.empty(b)&&(e.data=b),a.open(e)}}var d=this,e={newDashboard:{template:"dashboard/views/new_dashboard_modal.html",controller:"NewDashboardController"},rotations:{template:"rotation/views/rotations_modal.html",controller:"RotationsSettingsController"},login:{template:"core/views/login_modal.html",controller:"LoginController"},dashboardSettings:{template:"dashboard/views/dashboard_settings_modal.html",controller:"DashboardSettingsController"},newWidget:{template:"widget/views/new_widget_modal.html",controller:"NewWidgetController"},widgetSettings:{template:"widget/views/widget_settings_modal.html",controller:"WidgetSettingsController"}};d.createModal=c,b()}angular.module("teaparty2.core").service("ModalService",a),a.$inject=["ngDialog"]}(),function(){function a(a){return{restrict:"A",replace:!1,scope:{items:"=",select:"&"},link:function(b,c){var d=b.select();b.id=Math.random(),b.isPopoverOpened=!1,b.closePopover=function(){b.popoverElement[0].style.display="none"},b.togglePopover=function(){var a="block"===b.popoverElement[0].style.display?"none":"block";return b.popoverElement[0].style.display=a,a},b.selectItem=function(a){b.closePopover(),d(a)};var e='\n                    <div class="popover">\n                        <div class="popover__item"\n                             ng-repeat="item in items"\n                             ng-click="selectItem(item)">\n                            {{item}}\n                        </div>\n                    </div>';c.after(e),b.popoverElement=c.next(),b.closePopover(),a(b.popoverElement)(b)},controller:b}}function b(a,b,c,d){a.$on("popoverOpenEvent",function(b,c){is.not.undefined(c)&&c.id!==a.id&&a.closePopover()}),b.on("click",function(){"none"!==a.togglePopover()&&d.$broadcast("popoverOpenEvent",{id:a.id})})}angular.module("teaparty2.core").directive("popover",a),a.$inject=["$compile"],b.$inject=["$scope","$element","$attrs","$rootScope"]}(),function(){function a(a,b){var c="/api/settings",d=this;d.settings=void 0,d.get=function(){return b(function(b,e){var f;return is.not.undefined(d.settings)?b(d.settings):(f=a.get(c),f.success(function(a){d.settings=a,b(d.settings)}),void f.error(function(){return e()}))})}}angular.module("teaparty2.core").service("Settings",a),a.$inject=["$http","$q"]}(),function(){angular.module("teaparty2.core").service("Sockets",["$rootScope","socketFactory",function(a,b){var c=this;c.init=function(){},c.socketFactory=b(),c.socketFactory.on("widgets_update",function(b){b.forEach(function(b){a.$broadcast("widgetUpdateEvent:"+b._id,b.data)})}),c.socketFactory.on("rotation_update",function(b){a.$broadcast("rotationUpdateEvent:"+b._id,b)}),c.socketFactory.on("rotation_control",function(b){a.$broadcast("rotationControlEvent:"+b._id,b)})}])}(),function(){angular.module("teaparty2.core").factory("TemplatePath",function(){return{get:function(a){var b=void 0===arguments[1]?a:arguments[1];return function(){return"widgets/"+a+"/view/"+b+".template"}()}}})}(),function(){function a(){return{restrict:"EA",replace:!0,scope:{widgets:"=",selectedDashboard:"=src",options:"=?"},templateUrl:"dashboard/dashboard_container/dashboard_container.template",link:b,controller:c}}function b(a){a.state="locked",a.$watch("selectedDashboard",function(b){is.undefined(b)||a.renderDashboard()}),a.$watch("options",function(){a.updateOptions()},!0)}function c(a,b,c,e,f,g){function h(b,c,d,e){var f=a.$$childHead.gridster,h=(f.curColWidth-2*f.margins[0])*e.y,i=(f.curRowHeight-2*f.margins[1])*e.x;a.$broadcast("widgetSizeChangeEvent:"+d.id,i,h),g.moveWidget(a.selectedDashboard._id,d.id,{size:e})}function i(b,c,d,e){a.$broadcast("widgetPositionChangeEvent:"+d.id),g.moveWidget(a.selectedDashboard._id,d.id,{position:e})}var j=1e3;a.gridsterOpts={resizable:{stop:h},draggable:{stop:i}},a.updateOptions=function(){a.gridsterOpts=d(a.gridsterOpts,a.options),a.state=a.gridsterOpts.resizable.enabled&&a.gridsterOpts.draggable.enabled?"unlocked":"locked"},a.renderDashboard=function(){if(a.gridsterOpts.columns=a.selectedDashboard.columns||10,b.html(""),a.selectedDashboard.widgets.length){var c='<div gridster="gridsterOpts">';a.selectedDashboard.widgets.forEach(function(b,d){c+='<li gridster-item row="'+b.position[0]+'" col="'+b.position[1]+'"\n                         size-x="'+b.size.x+'" size-y="'+b.size.y+'" id="'+b._id+'">\n\n                        <widget-container dashboard-id="'+a.selectedDashboard._id+'" widget="selectedDashboard.widgets['+d+']">\n                            <widget-'+b.type+' class="widget" widget="selectedDashboard.widgets['+d+']">\n                            </widget-'+b.type+">\n                        </widget-container>\n                    </li>"}),c+="</div>";var d=angular.element(c);b.append(d),e(d)(a),f(function(){a.$broadcast("widgetReadyEvent")},j)}}}function d(a,b){for(var c in b)if(b.hasOwnProperty(c))if("resizable"===c||"draggable"===c){"undefined"==typeof a[c]&&(a[c]={});for(var d in b[c])b[c].hasOwnProperty(d)&&(a[c][d]=b[c][d])}else a[c]=b[c];return a}angular.module("teaparty2.dashboard").directive("dashboardContainer",a),c.$inject=["$scope","$element","$attrs","$compile","$timeout","DashboardWidgetService"]}(),function(){function a(){return{restrict:"EA",replace:!0,scope:{options:"=",selected:"=",onChange:"=",onRemove:"="},templateUrl:"dashboard/dashboard_select/dashboard_select.template",link:function(a){a.showDropdown=!1,a.select=function(b){a.showDropdown=!1,a.onChange(b)},a.removeDashboard=function(b){a.onRemove(b)}}}}angular.module("teaparty2.dashboard").directive("dashboardSelect",a)}(),function(){function a(a,b){function c(a,b){return g("post",h(a,b))}function d(a,b){return g("delete",h(a,b))}function e(a,b,c){return g("post",h(a,b)+"/move",c)}function f(a,b,c){return g("post",h(a,c)+("/move/"+b))}function g(c,d){var e=void 0===arguments[2]?{}:arguments[2];return b(function(b,f){var g=a[c](d,e);g.success(function(a){return b(a)}),g.error(function(a,b){return f(a,b)})})}function h(a,b){return"/api/dashboard/"+a+"/widget/"+b}var i=this;i.addWidgetToDashboard=c,i.removeWidgetFromDashboard=d,i.moveWidget=e,i.moveWidgetToDashboard=f}angular.module("teaparty2.dashboard").service("DashboardWidgetService",a),a.$inject=["$http","$q"]}(),function(){function a(a,b,c){function d(){var d=new c({name:e.dashboardName});d.$save(function(){a.$broadcast("dashboardAddedEvent",d),b.close()},function(a){e.error=a.data?a.data.error:{message:"Server is unavailable"}})}var e=this;e.dashboardName="",e.error="",e.addDashboard=d}angular.module("teaparty2.dashboard").controller("NewDashboardController",a),a.$inject=["$rootScope","ngDialog","Dashboard"]}(),function(){function a(a){return a("/api/dashboard/:dashboardId",{dashboardId:"@dashboardId"},{list:{method:"GET",isArray:!0,url:"/api/dashboards"},update:{method:"PUT"}})}angular.module("teaparty2.dashboard").factory("Dashboard",a),a.$inject=["$resource"]}(),function(){function a(a,b,c,d,e){function f(){e.update({dashboardId:a.ngDialogData.dashboard._id,url:!0},function(b){a.ngDialogData.dashboard.url=b.url,j()},k)}function g(){e.update({dashboardId:a.ngDialogData.dashboard._id,name:l.name,columns:l.columns,"private":l["private"],IPAddressRange:l.IPAddressRange,IPWhitelistPolicy:l.IPWhitelistPolicy},function(){var b={};a.ngDialogData.dashboard.name=l.name,a.ngDialogData.dashboard["private"]=l["private"],a.ngDialogData.dashboard.IPWhitelistPolicy=l.IPWhitelistPolicy,a.ngDialogData.dashboard.IPAddressRange=l.IPAddressRange,a.ngDialogData.dashboard.columns!==l.columns&&(a.ngDialogData.dashboard.columns=l.columns,b.reload=!0),j(b),d.close()},k)}function h(){return l.baseUrl+a.ngDialogData.dashboard.url}function i(){e["delete"]({dashboardId:a.ngDialogData.dashboard._id},function(){b.$broadcast("dashboardDeletedEvent",{dashboardName:a.ngDialogData.dashboard}),d.close()})}function j(a){b.$broadcast("dashboardUpdatedEvent",a)}function k(a){l.error=a.data?a.data.error:{message:"Server is unavailable"}}var l=this;l.removeDashboard=i,l.updateDashboard=g,l.regenerateUrl=f,l.getDashboardUrl=h,l.name=a.ngDialogData.dashboard.name,l["private"]=a.ngDialogData.dashboard["private"],l.columns=a.ngDialogData.dashboard.columns||10,l.IPAddressRange=a.ngDialogData.dashboard.IPAddressRange,l.IPWhitelistPolicy=a.ngDialogData.dashboard.IPWhitelistPolicy,l.baseUrl=c.location.origin+"/d/"}angular.module("teaparty2.dashboard").controller("DashboardSettingsController",a),a.$inject=["$scope","$rootScope","$window","ngDialog","Dashboard"]}(),function(){angular.module("teaparty2.datasource").factory("Datasource",["$resource",function(a){return a("/api/datasource",{datasourceId:"@datasourceId"})}])}(),function(){function a(){return function(){var a=void 0===arguments[0]?"":arguments[0],b=void 0===arguments[1]?void 0:arguments[1],c=void 0===arguments[2]?", ":arguments[2],d=[],e=!0,f=!1,g=void 0;try{for(var h,i=a[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;is.not.undefined(j[b])&&d.push(j[b])}}catch(k){f=!0,g=k}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}return d.join(c)}}angular.module("teaparty2.core").filter("fieldsConcat",a)}(),function(){function a(a){return a("/api/rotation/:url",{rotationId:"@rotationId",dashboardID:"@dashboardID"},{"delete":{url:"/api/rotation/:rotationId",method:"DELETE"},update:{url:"/api/rotation/:rotationId",method:"PUT"},list:{method:"GET",isArray:!0,url:"/api/rotations"},addDashboard:{url:"/api/rotation/:rotationId/:dashboardID",method:"POST"},removeDashboard:{url:"/api/rotation/:rotationId/:dashboardID",method:"DELETE"},updateDashboard:{url:"/api/rotation/:rotationId/:dashboardID",method:"PUT"}})}angular.module("teaparty2.rotation").factory("Rotation",a),a.$inject=["$resource"]}(),function(){function a(a,b,c,d,e,f,g){function h(c){a.$on("rotationUpdateEvent:"+c._id,function(a,d){d._id===c._id&&b.location.reload()}),a.$on("rotationControlEvent:"+c._id,function(a,b){if(b._id===c._id)switch(b.type){case"pause":i();break;case"resume":j();break;case"selectDashboard":k(b.dashboardId)}}),is.not.empty(p.dashboards)&&m(s)}function i(){is.undefined(o)&&(c.cancel(n),r.paused=!0,o=c(function(){j()},q))}function j(){l(s),c.cancel(o),o=void 0}function k(a){for(var b=0;b<p.dashboards.length;b++)if(p.dashboards[b]._id===a)return m(b)}function l(a){r.paused=!1,c.cancel(n),n=c(function(){m(a+1)},1e3*p.dashboards[a].timeout)}function m(a){p.dashboards.length<=a&&(a=0);var b=p.dashboards[a];s=a,g.get({dashboardId:b._id},function(b){r.selectedDashboard=b,l(a)},function(){m(a+1)})}var n,o,p,q=3e5,r=this,s=0;r.selectedDashboard=void 0,r.paused=!1,r.options={resizable:{enabled:!1},draggable:{enabled:!1}},p=f.get({url:e.url},h,function(){return d.go("app")})}angular.module("teaparty2.rotation").controller("RotationController",a),a.$inject=["$scope","$window","$timeout","$state","$stateParams","Rotation","Dashboard"]}(),function(){function a(a,b,c){function d(){q.rotations=b.list(),q.dashboards=c.list()}function e(){(new b).$save(),q.rotations=b.list()}function f(a,c){b.removeDashboard({rotationId:a._id,dashboardID:c._id},function(){for(var b=0;b<a.dashboards.length;b++)if(a.dashboards[b]._id===c._id)return a.dashboards.splice(b,1)})}function g(a,c){b.addDashboard({rotationId:a._id,dashboardID:c._id},function(){a.dashboards.push(c)})}function h(a){if("undefined"==typeof q.selectedRotation||"undefined"==typeof q.selectedRotation.dashboards)return!1;for(var b=0;b<q.selectedRotation.dashboards.length;b++)if(q.selectedRotation.dashboards[b]._id===a._id)return!0;return!1}function i(a){q.selectedRotation=a,q.view=2}function j(a){q.selectedRotation=a,q.name=a.name,q.view=1}function k(){q.selectedRotation=void 0,q.view=0}function l(a){return q.baseUrl+a.url}function m(){b.update({rotationId:q.selectedRotation._id,name:q.name},function(){q.selectedRotation.name=q.name},p)}function n(){b.update({rotationId:q.selectedRotation._id,url:!0},function(a){q.selectedRotation.url=a.url},p)}function o(a){b["delete"]({rotationId:a._id});for(var c=0;c<q.rotations.length;c++)a._id===q.rotations[c]._id&&q.rotations.splice(c,1);k()}function p(a){q.error=a.data?a.data.error:{message:"Server is unavailable"}}var q=this;q.baseUrl=a.location.origin+"/rotation/",q.rotations=[],q.dashboards=[],q.selectedRotation=void 0,q.createRotation=e,q.removeDashboardFromRotation=f,q.addDashboardToRotation=g,q.isDashboardInSelectedRotation=h,q.openDashboards=i,q.deselectRotation=k,q.openSettings=j,q.view=0,q.getRotationUrl=l,q.updateRotation=m,q.regenerateUrl=n,q.removeRotation=o,d()}angular.module("teaparty2.rotation").controller("RotationsSettingsController",a),a.$inject=["$window","Rotation","Dashboard"]}(),function(){function a(){return{restrict:"EA",replace:!0,scope:{dashboard:"=",rotation:"="},templateUrl:"rotation/timeout_directive/timeout_directive.template",link:b,controller:c}}function b(a){a.id=Math.random(),a.isPopoverOpened=!1,a.closePopover=function(){return a.isPopoverOpened=!1}}function c(a,b,c,d,e){a.$on("popoverOpenEvent",function(b,c){is.not.undefined(c)&&c.id!==a.id&&a.closePopover()}),a.togglePopover=function(){d.$broadcast("popoverOpenEvent",{id:a.id}),a.isPopoverOpened=!a.isPopoverOpened},a.setDashboardTimeout=function(b,c,d){a.closePopover(),e.updateDashboard({rotationId:b._id,dashboardID:c._id,timeout:d},function(){c.timeout=d})}}angular.module("teaparty2.widget").directive("timeout",a),c.$inject=["$scope","$element","$attrs","$rootScope","Rotation"]}(),function(){function a(){this.textFill=function(a,b,c){var d,e,f=100,g=10,h=10;do a.style.fontSize=f+"px",d=a.offsetHeight,e=a.offsetWidth,f-=1;while((d+h>c||e+h>b)&&f>g)}}angular.module("teaparty2.widget").service("WidgetHelper",a)}(),function(){function a(a,b,c,d,e,f,g){function h(){var d=new e({type:k.widgetType,caption:k.widgetCaption});d.$save(function(e){"PUSH"!==k.datasourceType&&i(d);var f=g.addWidgetToDashboard(a.ngDialogData.dashboard._id,e._id);f.then(function(){b.$broadcast("widgetAddedEvent",{dashboardId:a.ngDialogData.dashboard._id}),c.close()},j)},j)}function i(a){var b=new f({type:k.datasourceType,url:k.pullURL,widgetId:a._id});b.$save(function(b){e.update({widgetId:a._id,datasource:b._id})})}function j(a){k.error=a.data?a.data.error:{message:"Server is unavailable"}}var k=this;k.availableWidgetTypes=[],k.availableDatasourcesTypes=[],k.widgetType=void 0,k.datasourceType=void 0,k.widgetCaption="",k.error="",k.addWidget=h,k.pullURL="",d.get().then(function(a){k.availableWidgetTypes=a.widgetTypes,k.availableDatasourcesTypes=a.datasourcesTypes,0!==k.availableWidgetTypes.length&&(k.widgetType=k.availableWidgetTypes[0]),0!==k.availableDatasourcesTypes.length&&(k.datasourceType=k.availableDatasourcesTypes[0])})}angular.module("teaparty2.widget").controller("NewWidgetController",a),a.$inject=["$scope","$rootScope","ngDialog","Settings","Widget","Datasource","DashboardWidgetService"]}(),function(){angular.module("teaparty2.widget").factory("Widget",["$resource",function(a){return a("/api/widget/:widgetId",{widgetId:"@widgetId"},{update:{method:"PUT"}})}])}(),function(){function a(a,b,c,d,e){function f(){d.update({widgetId:a.ngDialogData.widget._id,caption:k.caption},function(){a.ngDialogData.widget.caption=k.caption,c.close()},j)}function g(){var d=e.removeWidgetFromDashboard(a.ngDialogData.dashboardId,a.ngDialogData.widget._id);d.then(function(){b.$broadcast("widgetDeletedEvent",{dashboardId:a.ngDialogData.dashboardId}),c.close()})}function h(){var f=new d({type:a.ngDialogData.widget.type,caption:a.ngDialogData.widget.caption});f.$save(function(d){var f=e.addWidgetToDashboard(a.ngDialogData.dashboardId,d._id);f.then(function(){b.$broadcast("widgetAddedEvent",{dashboardId:a.ngDialogData.dashboardId}),c.close()},j)},j)}function i(d){var f=!0,g=!1,h=void 0;try{for(var i,j=b.dashboards[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k,l=function(){var f=i.value;return f.name===d?(k=e.moveWidgetToDashboard(a.ngDialogData.dashboardId,f._id,a.ngDialogData.widget._id),{v:k.then(function(){b.$broadcast("widgetAddedEvent",{dashboardId:f._id}),b.$broadcast("widgetDeletedEvent",{dashboardId:a.ngDialogData.dashboardId}),c.close()})}):void 0}();if("object"==typeof l)return l.v}}catch(m){g=!0,h=m}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}}function j(a){k.error=a.data?a.data.error:{message:"Server is unavailable"}}var k=this;k.availableDashboards=[],k.removeWidget=g,k.cloneWidget=h,k.updateWidget=f,k.moveToDashboard=i,k.caption=a.ngDialogData.widget.caption,b.dashboards.map(function(b){b._id!==a.ngDialogData.dashboardId&&k.availableDashboards.push(b.name)})}angular.module("teaparty2.widget").controller("WidgetSettingsController",a),a.$inject=["$scope","$rootScope","ngDialog","Widget","DashboardWidgetService"]}(),function(){function a(){this.update=function(a,b){a.$on("widgetUpdateEvent:"+a.widget._id,function(c,d){a.widget.data=d,"function"==typeof b&&b(d)})},this.sizeChange=function(a,b){a.$on("widgetSizeChangeEvent:"+a.widget._id,function(a,c,d){"function"==typeof b&&b(c,d)})},this.ready=function(a,b){"function"==typeof b&&a.$on("widgetReadyEvent",b)}}angular.module("teaparty2.widget").service("WidgetSubscriber",a)}(),function(){function a(){return{restrict:"E",replace:!0,transclude:!0,scope:{widget:"=",dashboardId:"@"},templateUrl:"widget/widget_container/widget_container.template",link:b,controller:c}}function b(a){a.rendered=!1,a.$on("widgetReadyEvent",function(){a.rendered=!0})}function c(a,b,c,d){a.openWidgetSettingsDialog=function(){return d.widgetSettings({dashboardId:a.dashboardId,widget:a.widget})}}angular.module("teaparty2.widget").directive("widgetContainer",a),c.$inject=["$scope","$element","$attrs","ModalService"]}(),angular.module("teaparty2.widgets").directive("widgetHighcharts",["TemplatePath",function(a){return{restrict:"E",replace:!0,scope:{widget:"=widget"},templateUrl:a.get("highcharts"),link:function(a,b){a.container=b.find("div")[0],a.rendering=!1,a.render=function(){"undefined"==typeof a.widget.data.chart&&(a.widget.data.chart={}),a.widget.data.chart.renderTo=a.container,a.widget.data.chart.spacingTop=30,a.chart=new Highcharts.Chart(a.widget.data),a.chartElement=Sizzle(".highcharts-container",a.container)[0]},a.render()},controller:["$scope","$element","$attrs","$timeout","WidgetSubscriber",function(a,b,c,d,e){function f(){a.rendering=!0,a.chartElement.style.display="none"}function g(){a.rendering=!1,a.chartElement.style.display="block"}a.reflow=function(){f(),d(function(){a.chart.reflow(),g()},1e3)},e.update(a,function(){a.render()}),e.sizeChange(a,function(){a.reflow()}),e.ready(a,function(){a.reflow()})}]}}]),angular.module("teaparty2.widgets").directive("widgetList",["TemplatePath",function(a){var b=500;return{restrict:"E",replace:!0,scope:{widget:"=widget"},templateUrl:a.get("list"),link:function(a,b){a.listElement=Sizzle(".widget-list-container",b[0])[0]},controller:["$scope","$element","$attrs","$timeout","WidgetSubscriber",function(a,c,d,e,f){a.autoScale=function(){return function(b){e(function(){if(a.listElement.style.transform="scale(1)",a.listElement.offsetHeight>c[0].offsetHeight){var b=c[0].offsetHeight/a.listElement.offsetHeight;a.listElement.style.transform="scale("+b+")"}},b)}}(),f.ready(a,a.autoScale),f.update(a,a.autoScale),f.sizeChange(a,function(){a.autoScale(b)})}]}}]),angular.module("teaparty2.widgets").directive("widgetNumber",["TemplatePath",function(a){return{restrict:"E",replace:!0,scope:{widget:"=widget"},templateUrl:a.get("number"),link:function(a,b){a.textElement=Sizzle(".widget-number__data > span",b[0])[0]},controller:["$scope","$element","$attrs","WidgetSubscriber","WidgetHelper",function(a,b,c,d,e){d.update(a),d.sizeChange(a,function(b,c){e.textFill(a.textElement,b,c)}),d.ready(a,function(){e.textFill(a.textElement,b[0].offsetWidth,b[0].offsetHeight)})}]}}]),angular.module("teaparty2.widgets").directive("widgetRag",["TemplatePath",function(a){return{restrict:"E",replace:!0,scope:{widget:"=widget"},templateUrl:a.get("rag"),controller:["$scope","$element","$attrs","WidgetSubscriber",function(a,b,c,d){d.update(a)}]}}]),angular.module("teaparty2.widgets").directive("widgetStatus",["TemplatePath",function(a){return{restrict:"E",replace:!0,scope:{widget:"=widget"},templateUrl:a.get("status"),controller:["$scope","$element","$attrs","WidgetSubscriber",function(a,b,c,d){d.update(a)}]}}]),angular.module("teaparty2.widgets").directive("widgetText",["TemplatePath",function(a){return{restrict:"E",replace:!0,scope:{widget:"=widget"},templateUrl:a.get("text"),link:function(a,b){a.textElement=Sizzle(".widget-text__caption-inner > span",b[0])[0]},controller:["$scope","$element","$attrs","WidgetSubscriber","WidgetHelper",function(a,b,c,d,e){d.update(a),d.sizeChange(a,function(b,c){e.textFill(a.textElement,b,c)}),d.ready(a,function(){e.textFill(a.textElement,b[0].offsetWidth,b[0].offsetHeight)})}]}}]),angular.module("teaparty2.template",[]).run(["$templateCache",function(a){a.put("dashboard/dashboard_container/dashboard_container.template",'<div class="d-dashboard d-dashboard--{{state}}">\n\n    <div class="spinner"></div>\n\n</div>\n'),a.put("dashboard/dashboard_select/dashboard_select.template",'<div class="d-custom-select">\n\n    <div class="d-custom-select__selector"\n         ng-show="options.length > 0"\n         ng-click="showDropdown = !showDropdown"\n         ng-class="{\'active\': showDropdown}"   >\n\n        <span>{{selected.name}}</span>\n        <i class="icon-down-dir"></i>\n\n    </div>\n\n    <div class="d-custom-select__dropdown" ng-show="showDropdown">\n\n        <div class="d-custom-select__dropdown-item"\n             ng-repeat="dashboard in options"\n             ng-show="!dashboard.deleted">\n\n            <span ng-click="select(dashboard.url)">{{dashboard.name}}</span>\n\n        </div>\n\n    </div>\n\n</div>'),a.put("rotation/timeout_directive/timeout_directive.template",'<div class="timeout-select">\n\n    <a class="context-link" href="#" ng-click="togglePopover()">{{dashboard.timeout || 30}}</a> seconds\n\n    <div class="popover" ng-show="isPopoverOpened">\n\n        <div class="popover__item"\n             ng-repeat="item in [15, 30, 45, 60]"\n             ng-click="setDashboardTimeout(rotation, dashboard, item)">\n            {{item}}\n        </div>\n\n    </div>\n\n</div>\n'),a.put("widget/widget_container/widget_container.template",'<div class="d-widget-container" ng-hide="deleted">\n\n    <div class="d-widget-container__controls">\n        <i class="icon-cog" ng-click="openWidgetSettingsDialog()"></i>\n    </div>\n\n    <div class="d-widget-container__body"\n         ng-class="{\'d-widget-container__body--rendered\': rendered}"\n         ng-transclude></div>\n\n</div>')}]),angular.module("teaparty2.widgets.template",[]).run(["$templateCache",function(a){a.put("widgets/highcharts/view/highcharts.template",'<div class="widget-highcharts">\n\n    <span class="widget-caption widget-highcharts__caption">{{widget.caption}}</span>\n\n    <span class="spinner" ng-show="rendering"></span>\n\n    <div class="widget-highcharts__chart-container"></div>\n\n</div>'),a.put("widgets/list/view/list.template",'<div class="widget-list">\n\n    <div class="widget-caption" ng-show="!!widget.caption">{{widget.caption}}</div>\n\n    <ul class="widget-list-container"\n        ng-class="{\'widget-list-container--with-caption\': !!widget.caption}">\n\n        <li class="widget-list-item" ng-repeat="item in widget.data">\n\n            <span class="widget-list-item__value">{{item.value}}</span>\n            <span class="widget-list-item__label">{{item.label}}</span>\n\n        </li>\n\n    </ul>\n\n</div>'),a.put("widgets/number/view/number.template",'<div class="widget-number">\n\n    <div class="widget-caption">\n        {{widget.caption}}\n    </div>\n\n    <div class="widget-number__data">\n\n        <span>\n\n            {{widget.data.value}}\n\n        </span>\n\n    </div>\n\n</div>'),a.put("widgets/rag/view/rag.template",'<div class="widget-rag">\n\n    <div class="widget-caption widget-rag__caption">\n        {{widget.caption}}\n    </div>\n\n    <table class="widget-rag__table">\n\n        <tr class="widget-rag__row widget-rag__row--top">\n            <td>{{widget.data[0].value}}</td>\n            <td>{{widget.data[0].text}}</td>\n        </tr>\n        <tr class="widget-rag__row widget-rag__row--middle">\n            <td>{{widget.data[1].value}}</td>\n            <td>{{widget.data[1].text}}</td>\n        </tr>\n        <tr class="widget-rag__row widget-rag__row--bottom">\n            <td>{{widget.data[2].value}}</td>\n            <td>{{widget.data[2].text}}</td>\n        </tr>\n\n    </table>\n\n</div>'),a.put("widgets/status/view/status.template",'<div class="widget-status">\n\n    <div class="widget-status__caption">\n\n        <div class="widget-status__caption-inner">\n\n            {{widget.caption}}\n\n        </div>\n\n    </div>\n\n    <div class="widget-status__indicator widget-status__indicator--{{widget.data.status}}">\n\n    </div>\n\n</div>'),a.put("widgets/text/view/text.template",'<div class="widget-text">\n\n    <div class="widget-text__caption">\n\n        <div class="widget-text__caption-inner">\n\n            <span>\n\n                {{widget.data.text || widget.caption}}\n\n            </span>\n\n        </div>\n\n    </div>\n\n</div>')
}]);